blueprint:
  name: Frigate Pushover Notifications (Multi-Camera)
  description: Send Frigate events with AI data and images to Pushover
  domain: automation
  input:
    frigate_cameras:
      name: Select Cameras
      description: Choose multiple Frigate cameras
      selector:
        device:
          integration: frigate
          multiple: true
    pushover_target:
      name: Pushover Notification Target
      selector:
        target:
          entity:
            domain: notify
    frigate_objects:
      name: Objects to Alert
      description: Select detectable objects
      default: []
      selector:
        select:
          multiple: true
          options:
            - person
            - car
            - dog
            - cat
            - package

variables:
  frigate_url: "https://your-frigate-server.com"  # External Frigate URL
  event_id: "{{ trigger.payload_json['after']['id'] }}"
  camera: "{{ trigger.payload_json['after']['camera'] }}"
  object: "{{ trigger.payload_json['after']['label'] | lower }}"
  ai_description: "{{ trigger.payload_json['after']['data']['sub_labels'] | first }}"
  snapshot_url: "{{ frigate_url }}/api/events/{{ event_id }}/snapshot.jpg"

trigger:
  - platform: mqtt
    topic: "frigate/events"
    payload: "{{ object }}"
    value_template: "{{ trigger.payload_json['after']['label'] | lower }}"

condition:
  - condition: template
    value_template: "{{ camera in input.frigate_cameras }}"
  - condition: template
    value_template: "{{ object in input.frigate_objects }}"

action:
  - service: notify.pushover
    data:
      message: >
        {{ ai_description if ai_description else object | title }} detected
        in {{ camera | replace('_', ' ') | title }}
      title: "Security Alert - {{ object | title }}"
      data:
        attachment: "{{ snapshot_url }}"
        priority: 1
      target: "{{ input.pushover_target }}"

mode: queued
max: 10
